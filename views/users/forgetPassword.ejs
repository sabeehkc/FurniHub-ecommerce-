<%- include('../layout/header.ejs') %>

<header class="header">
    <div class="header-top">
        <div class="container">
            <div class="header-left">
                <div class="header-dropdown">
                    <a href="#">Usd</a>
                </div><!-- End .header-dropdown -->

                <div class="header-dropdown">
                    <a href="#">Eng</a>
                </div><!-- End .header-dropdown -->
            </div><!-- End .header-left -->

            <div class="header-right">
                <ul class="top-menu">
                    <li>
                        <a href="#">Links</a>
                        <ul>
                            <li><a href="tel:#"><i class="icon-phone"></i>Call: +91 9778073408</a></li>
                            <li><a href="/wishlist"><i class="icon-heart-o"></i>My Wishlist</a></li>
                            <li><a href="/about">About Us</a></li>
                            <li><a href="">Contact Us</a></li>
                            <li><a href="/login"><i class="icon-user"></i>Login</a></li>
                        </ul>
                    </li>
                </ul><!-- End .top-menu -->
            </div><!-- End .header-right -->
        </div><!-- End .container -->
    </div><!-- End .header-top -->

    <div class="header-middle sticky-header">
        <div class="container">
            <div class="header-left">
                <button class="mobile-menu-toggler">
                    <span class="sr-only">Toggle mobile menu</span>
                    <i class="icon-bars"></i>
                </button>

                <a href="index.html" class="logo">
                    <img src="assets/images/logo.png" alt="FurniHub Logo" width="105" height="25">
                </a>

                <nav class="main-nav">
                    <ul class="menu">
                        <li class="megamenu-container active">
                            <a href="/">Home</a>
                        </li>
                        <li>
                            <a href="/all-products">Shop</a>
                        </li>
                        <li>
                            <a href="" >Product</a>
                        </li>
                        <!-- <li>
                            <a href="#" class="sf-with-ul">Pages</a>

                            <ul>
                                <li><a href="/login">Login</a></li>
                                <li>
                                    <a href="/about" >About</a>
                                </li>
                                <li>
                                    <a href="" >Contact</a>
                                </li>
                               
                            </ul>
                        </li> -->
                        <!-- <li>
                            <a href="">Profile</a>
                        </li> -->
                    </ul><!-- End .menu -->
                </nav><!-- End .main-nav -->
            </div><!-- End .header-left -->

                <div class="header-right" >
                    <div class="header-search ">
                        <a href="#" class="search-toggle" role="button" title="Search"><i class="icon-search"></i></a>
                        <form action="#" method="get">
                            <div class="header-search-wrapper ">
                                <label for="q" class="sr-only">Search</label>
                                <input type="search" class="form-control" name="q" id="q" placeholder="Search in..." required>
                            </div><!-- End .header-search-wrapper -->
                        </form>
                    </div><!-- End .header-search -->

                    <!-- <div class="header-wishlist   pl-5 bg-warning">
                       <a href="/wishlist"><i class="wishlist-icon fa-regular fa-heart "></i></a> 
                    </div>   wishlist end -->

                    <div class="dropdown cart-dropdown">
                        <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static">
                            <i class="icon-shopping-cart"></i>
                            <!-- <span class="cart-count">2</span> -->
                        </a>

                        <!-- <div class="dropdown-menu dropdown-menu-right">
                            <div class="dropdown-cart-products">
                                <div class="product">
                                    <div class="product-cart-details">
                                        <h4 class="product-title">
                                            <a href="product.html">Beige knitted elastic runner shoes</a>
                                        </h4>

                                        <span class="cart-product-info">
                                            <span class="cart-product-qty">1</span>
                                            x $84.00
                                        </span>
                                    </div> End .product-cart-details 

                                    <figure class="product-image-container">
                                        <a href="product.html" class="product-image">
                                            <img src="assets/images/products/cart/product-1.jpg" alt="product">
                                        </a>
                                    </figure>
                                    <a href="#" class="btn-remove" title="Remove Product"><i class="icon-close"></i></a>
                                </div>End .product

                                <div class="product">
                                    <div class="product-cart-details">
                                        <h4 class="product-title">
                                            <a href="product.html">Blue utility pinafore denim dress</a>
                                        </h4>

                                        <span class="cart-product-info">
                                            <span class="cart-product-qty">1</span>
                                            x $76.00
                                        </span>
                                    </div> End .product-cart-details 

                                    <figure class="product-image-container">
                                        <a href="product.html" class="product-image">
                                            <img src="assets/images/products/cart/product-2.jpg" alt="product">
                                        </a>
                                    </figure>
                                    <a href="#" class="btn-remove" title="Remove Product"><i class="icon-close"></i></a>
                                </div>End .product
                            </div> End .cart-product 

                            <div class="dropdown-cart-total">
                                <span>Total</span>

                                <span class="cart-total-price">$160.00</span>
                            </div>End .dropdown-cart-total 

                            <div class="dropdown-cart-action">
                                <a href="cart.html" class="btn btn-primary">View Cart</a>
                                <a href="checkout.html" class="btn btn-outline-primary-2"><span>Checkout</span><i class="icon-long-arrow-right"></i></a>
                            </div>End .dropdown-cart-total
                        </div>End .dropdown-menu -->
                    </div><!-- End .cart-dropdown -->
                    <!-- <div class="profile-icon">
                        <a href="/profile" style="font-size: 20px; padding-left: 15px; color: black;"><i class="fa-solid fa-user"></i>
                        </a>
                    </div> End porfile icon -->
                </div><!-- End .header-right -->
            </div><!-- End .container -->
        </div><!-- End .header-middle -->
    </header><!-- End .header -->


<main class="main">
    <nav aria-label="breadcrumb" class="breadcrumb-nav border-0 mb-0">
        <div class="container">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Forgotten Password</li>
            </ol>
        </div><!-- End .container -->
    </nav><!-- End .breadcrumb-nav -->

    <div class="login-page bg-image pt-8 pb-8 pt-md-12 pb-md-12 pt-lg-17 pb-lg-17" style="background-image: url('assets/images/backgrounds/login.jpg')">
        <div class="container">
           
            <div class="form-box" style="background-color: rgb(204, 202, 202);">
                <div class="text-center">
                    <h3>Forgotten Password</h3>
                    <hr style="border-color: rgb(230, 151, 4);">
                </div>
               
                <form id="changePasswordForm" onsubmit="return handleSubmit(event)">
                   
                    <div class="form-group">
                        <label for="newPassword" class="pl-3">New Password:</label>
                        <input type="password" name="newPassword" class="form-control bg-mute" id="newPassword" placeholder="Enter new password">
                        <small id="newPasswordError" class="text-danger"></small>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" class="pl-3">Confirm New Password:</label>
                        <input type="password" name="confirmPassword" class="form-control bg-mute" id="confirmPassword" placeholder="Confirm new password">
                        <small id="confirmPasswordError" class="text-danger"></small>
                    </div>
                   
    
                    <div class="form-footer d-flex" style="justify-content: center;">
                        <button type="submit" name="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div><!-- End .form-box -->
       
        </div><!-- End .container -->
    </div><!-- End .login-page section-bg -->
    
    
</main><!-- End .main -->
<%- include('../layout/allfooter.ejs') %>

</div><!-- End .page-wrapper -->
<button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

<%- include('../layout/mobile.ejs') %>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    function validate() {
        const newPassword = document.getElementById('newPassword').value.trim();
        const confirmPassword = document.getElementById('confirmPassword').value.trim();

        const newPasswordError = document.getElementById('newPasswordError');
        const confirmPasswordError = document.getElementById('confirmPasswordError');

        newPasswordError.textContent = '';
        confirmPasswordError.textContent = '';

        let isValid = true;


        if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/.test(newPassword)) {
            newPasswordError.textContent = 'Password must be at least 6 characters and include at least one uppercase letter, one lowercase letter, one number, and one special character.';
            isValid = false;
        }

        if (newPassword !== confirmPassword) {
            confirmPasswordError.textContent = 'Passwords do not match.';
            isValid = false;
        }

        return isValid;
    }

    function handleSubmit(event) {
        event.preventDefault();

        if (!validate()) {
            return false;
        }

        const newPassword = document.getElementById('newPassword').value.trim();
        const confirmPassword = document.getElementById('confirmPassword').value.trim();

        const data = {
            newPassword,
            confirmPassword
        };

        fetch('/forgetPassword', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Password Changed Successfully',
                    text: 'Your password has been updated.',
                    timer: 1500,
                    showConfirmButton: false
                }).then(() => {
                    window.location.href = '/login';
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: data.message || 'An error occurred while changing the password.',
                });
            }
        })
        .catch(error => {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'An error occurred while changing the password. Please try again.',
            });
        });
    }
</script>

<!-- Plugins JS File -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/jquery.hoverIntent.min.js"></script>
<script src="assets/js/jquery.waypoints.min.js"></script>
<script src="assets/js/superfish.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<!-- Main JS File -->
<script src="assets/js/main.js"></script>

<%- include('../layout/footer.ejs') %>